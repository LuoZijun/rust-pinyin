

pub(crate) const _________: &'static str = "";

// ∅ b p m f d t n l g k h j q x zh ch sh r z c s
pub static PINYIN_TABLE: [&'static str; 990] = [
//        ∅,         b,         p,         m,         f,         d,         t,         n,         l,         g,         k,         h,         j,         q,         x,        zh,        ch,        sh,         r,         z,         c,         s,
// Group a Finals
  _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,     "zhi",     "chi",     "shi",      "ri",      "zi",      "ci",      "si",
        "a",      "ba",      "pa",      "ma",      "fa",      "da",      "ta",      "na",      "la",      "ga",      "ka",      "ha", _________, _________, _________,     "zha",     "cha",     "sha", _________,      "za",      "ca",      "sa",
        "e", _________, _________,      "me", _________,      "de",      "te",      "ne",      "le",      "ge",      "ke",      "he", _________, _________, _________,     "zhe",     "che",     "she",      "re",      "ze",      "ce",      "se",
        "ê", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
       "er", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
       "ai",     "bai",     "pai",     "mai", _________,     "dai",     "tai",     "nai",     "lai",     "gai",     "kai",     "hai", _________, _________, _________,    "zhai",    "chai",    "shai", _________,     "zai",     "cai",     "sai",
       "ei",     "bei",     "pei",     "mei",     "fei",     "dei",     "tei",     "nei",     "lei",     "gei",     "kei",     "hei", _________, _________, _________,    "zhei", _________,    "shei", _________,     "zei", _________,     "sei",
       "ao",     "bao",     "pao",     "mao", _________,     "dao",     "tao",     "nao",     "lao",     "gao",     "kao",     "hao", _________, _________, _________,    "zhao",    "chao",    "shao",     "rao",     "zao",     "cao",     "sao",
       "ou", _________,     "pou",     "mou",     "fou",     "dou",     "tou",     "nou",     "lou",     "gou",     "kou",     "hou", _________, _________, _________,    "zhou",    "chou",    "shou",     "rou",     "zou",     "cou",     "sou",
       "an",     "ban",     "pan",     "man",     "fan",     "dan",     "tan",     "nan",     "lan",     "gan",     "kan",     "han", _________, _________, _________,    "zhan",    "chan",    "shan",     "ran",     "zan",     "can",     "san",
       "en",     "ben",     "pen",     "men",     "fen",     "den", _________,     "nen", _________,     "gen",     "ken",     "hen", _________, _________, _________,    "zhen",    "chen",    "shen",     "ren",     "zen",     "cen",     "sen",
      "ang",    "bang",    "pang",    "mang",    "fang",    "dang",    "tang",    "nang",    "lang",    "gang",    "kang",    "hang", _________, _________, _________,   "zhang",   "chang",   "shang",    "rang",    "zang",    "cang",    "sang",
      "eng",    "beng",    "peng",    "meng",    "feng",    "deng",    "teng",    "neng",    "leng",    "geng",    "keng",    "heng", _________, _________, _________,   "zheng",   "cheng",   "sheng",    "reng",    "zeng",    "ceng",    "seng",
// 注: "ong" 不存在
// 特殊音节组合
        "n", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,      "hn", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
        "m", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,      "hm", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
       "ng", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,     "hng", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,

// Group i Finals 
       "yi",      "bi",      "pi",      "mi", _________,      "di",      "ti",      "ni",      "li", _________, _________, _________,      "ji",      "qi",      "xi", _________, _________, _________, _________, _________, _________, _________,
       "ya", _________, _________, _________, _________,     "dia", _________,     "nia",     "lia", _________, _________, _________,     "jia",     "qia",     "xia", _________, _________, _________, _________, _________, _________, _________,
       "yo", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
       "ye",     "bie",     "pie",     "mie", _________,     "die",     "tie",     "nie",     "lie", _________, _________, _________,     "jie",     "qie",     "xie", _________, _________, _________, _________, _________, _________, _________,
//    "yai", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
      "yao",    "biao",    "piao",    "miao",    "fiao",    "diao",    "tiao",    "niao",    "liao", _________, _________, _________,    "jiao",    "qiao",    "xiao", _________, _________, _________, _________, _________, _________, _________,
      "you", _________, _________,     "miu", _________,     "diu", _________,     "niu",     "liu", _________, _________, _________,     "jiu",     "qiu",     "xiu", _________, _________, _________, _________, _________, _________, _________,
      "yan",    "bian",    "pian",    "mian", _________,    "dian",    "tian",    "nian",    "lian", _________, _________, _________,    "jian",    "qian",    "xian", _________, _________, _________, _________, _________, _________, _________,
      "yin",     "bin",     "pin",     "min", _________, _________, _________,     "nin",     "lin", _________, _________, _________,     "jin",     "qin",     "xin", _________, _________, _________, _________, _________, _________, _________,
     "yang",   "biang", _________, _________, _________,   "diang", _________,   "niang",   "liang", _________, _________, _________,   "jiang",   "qiang",   "xiang", _________, _________, _________, _________, _________, _________, _________,
     "ying",    "bing",    "ping",    "ming", _________,    "ding",    "ting",    "ning",    "ling", _________, _________, _________,    "jing",    "qing",    "xing", _________, _________, _________, _________, _________, _________, _________,
     "yong", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,   "jiong",   "qiong",   "xiong", _________, _________, _________, _________, _________, _________, _________,

// Group u Finals
       "wu",      "bu",      "pu",      "mu",      "fu",      "du",      "tu",      "nu",      "lu",      "gu",      "ku",      "hu", _________, _________, _________,     "zhu",     "chu",     "shu",      "ru",      "zu",      "cu",      "su",
       "wa", _________, _________, _________, _________, _________, _________, _________, _________,     "gua",     "kua",     "hua", _________, _________, _________,    "zhua",    "chua",    "shua",     "rua", _________, _________, _________,
       "wo",      "bo",      "po",      "mo",      "fo",     "duo",     "tuo",     "nuo",     "luo",     "guo",     "kuo",     "huo", _________, _________, _________,    "zhuo",    "chuo",    "shuo",     "ruo",     "zuo",     "cuo",     "suo",
      "wai", _________, _________, _________, _________, _________, _________, _________, _________,    "guai",    "kuai",    "huai", _________, _________, _________,   "zhuai",   "chuai",   "shuai", _________, _________, _________, _________,
      "wei", _________, _________, _________, _________,     "dui",     "tui", _________, _________,     "gui",     "kui",     "hui", _________, _________, _________,    "zhui",    "chui",    "shui",     "rui",     "zui",     "cui",     "sui",
      "wan", _________, _________, _________, _________,    "duan",    "tuan",    "nuan",    "luan",    "guan",    "kuan",    "huan", _________, _________, _________,   "zhuan",   "chuan",   "shuan",    "ruan",    "zuan",    "cuan",    "suan",
      "wen", _________, _________, _________, _________,     "dun",     "tun",     "nun",     "lun",     "gun",     "kun",     "hun", _________, _________, _________,    "zhun",    "chun",    "shun",     "run",     "zun",     "cun",     "sun",
     "wang", _________, _________, _________, _________, _________, _________, _________, _________,   "guang",   "kuang",   "huang", _________, _________, _________,  "zhuang",  "chuang",  "shuang", _________, _________, _________, _________,
     "weng", _________, _________, _________, _________,    "dong",    "tong",    "nong",    "long",    "gong",    "kong",    "hong", _________, _________, _________,   "zhong",   "chong",   "shong",    "rong",    "zong",    "cong",    "song",

// Group ü Finals
       "yu", _________, _________, _________, _________, _________, _________,      "nü",      "lü", _________, _________, _________,      "ju",      "qu",      "xu", _________, _________, _________, _________, _________, _________, _________,
      "yue", _________, _________, _________, _________, _________, _________,     "nüe",     "lüe", _________, _________, _________,     "jue",     "que",     "xue", _________, _________, _________, _________, _________, _________, _________,
     "yuan", _________, _________, _________, _________, _________, _________, _________,    "lüan", _________, _________, _________,    "juan",    "quan",    "xuan", _________, _________, _________, _________, _________, _________, _________,
      "yun", _________, _________, _________, _________, _________, _________, _________,     "lün", _________, _________, _________,     "jun",     "qun",     "xun", _________, _________, _________, _________, _________, _________, _________,

// 儿化音节 (er)    
      "wor",    "banr",     "pir",   "mianr",     "fur",   "dianr",   "tangr",     "nar", _________,     "ger",    "kour",    "hair",    "jinr", _________,    "xiar",    "zher", _________,    "shir", _________, _________, _________, _________,
     "wanr", _________, _________, _________, _________,   "dingr",    "tuir",     "nür", _________,    "ganr",   "kongr",    "haor", _________, _________,   "xianr", _________, _________,   "shuir", _________, _________, _________, _________,
  _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,    "huar", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
  _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,    "huor", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,
  _________, _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,    "huir", _________, _________, _________, _________, _________, _________, _________, _________, _________, _________,

];

// 汉语拼音中标声调位置的规则如下：
// 
// 1. 如果有a，则标在a上。
// 2. 如果没有a，但有o或e，则标在这两个字母上。这两个字母不会同时出现。
// 3. 如果也没有o和e，则一定有i、u或ü。如果i和u同时出现，则标在第二个韵母上。
//    这是特别针对ui和iu而言的（这两个音的实际读音应该是uei和iou）。
//    如果i和u不同时出现，则标在出现的那个韵母上。
// 
// "a", "ā", "á", "ǎ", "à",
// "e", "ē", "é", "ě", "è",
// "i", "ī", "í", "ǐ", "ì",
// "m", "m̄", "ḿ", "m̌", "m̀",
// "n", "n̄", "ń", "ň", "ǹ",
// "o", "ō", "ó", "ǒ", "ò",
// "u", "ū", "ú", "ǔ", "ù",
// "ê", "ê̄", "ế", "ê̌", "ề",
// "ü", "ǖ", "ǘ", "ǚ", "ǜ",


fn codegen(tone_index: usize, style: [ [&'static str; 5]; 9]) {
    let mut pos = 0usize;
    for py in PINYIN_TABLE.iter() {
        if pos == 0 {
            print!("  ");
        }

        if pos != 0 && pos % 22 == 0 {
            print!("\n  ");
        }

        if py == &_________ {
            print!("_________, ");
        } else {
            let a_index = py.find("a");
            let o_index = py.find("o");
            let e_index = py.find("e");

            let i_index = py.find("i");
            let u_index = py.find("u");
            let u2_index = py.find("ü");

            let (index, size) = if a_index.is_some() {
                (a_index.unwrap(), 1)
            } else if o_index.is_some() {
                (o_index.unwrap(), 1)
            } else if e_index.is_some() {
                (e_index.unwrap(), 1)
            } else {
                if i_index.is_some() && u_index.is_some() {
                    assert!(u2_index.is_none());
                    (std::cmp::max(i_index.unwrap(), u_index.unwrap()), 1)
                } else {
                    if i_index.is_some() {
                        assert!(u_index.is_none());
                        assert!(u2_index.is_none());

                        (i_index.unwrap(), 1)
                    } else if u_index.is_some() {
                        assert!(i_index.is_none());
                        assert!(u2_index.is_none());
                        
                        (u_index.unwrap(), 1)
                    } else if u2_index.is_some() {
                        assert!(i_index.is_none());
                        assert!(u_index.is_none());

                        (u2_index.unwrap(), 2)
                    } else {
                        match *py {
                            "ê"   => (0, 2),
                            "n"   => (0, 1),
                            "m"   => (0, 1),
                            "ng"  => (0, 1),
                            "hn"  => (1, 1),
                            "hm"  => (1, 1),
                            "hng" => (1, 1),
                            _     => panic!("[ERROR] 无法确定音节 `{}` 的元音！", py),
                        }
                    }
                }
            };

            let start = index;
            let end = index + size;

            // vowel
            let ch = &py[start..end];
            let pinyin_with_tone = match ch {
                "a" => py.replace(ch, style[0][tone_index]),
                "e" => py.replace(ch, style[1][tone_index]),
                "i" => py.replace(ch, style[2][tone_index]),
                "m" => py.replace(ch, style[3][tone_index]),
                "n" => py.replace(ch, style[4][tone_index]),
                "o" => py.replace(ch, style[5][tone_index]),
                "u" => py.replace(ch, style[6][tone_index]),
                "ê" => py.replace(ch, style[7][tone_index]),
                "ü" => py.replace(ch, style[8][tone_index]),
                _ => unreachable!(),
            };
            print!("{:>width$}, ", format!("\"{}\"", pinyin_with_tone), width = 9);
        }
        
        pos += 1;
    }
    println!();
}

fn main() {
    let styles = [
        [
            [ "a", "ā", "á", "ǎ", "à", ],
            [ "e", "ē", "é", "ě", "è", ],
            [ "i", "ī", "í", "ǐ", "ì", ],
            [ "m", "m̄", "ḿ", "m̌", "m̀", ],
            [ "n", "n̄", "ń", "ň", "ǹ", ],
            [ "o", "ō", "ó", "ǒ", "ò", ],
            [ "u", "ū", "ú", "ǔ", "ù", ],
            [ "ê", "ê̄", "ế", "ê̌", "ề", ],
            [ "ü", "ǖ", "ǘ", "ǚ", "ǜ", ],
        ],
        [
            [ "a", "a1", "a2", "a3", "a4", ],
            [ "e", "e1", "e2", "e3", "e4", ],
            [ "i", "i1", "i2", "i3", "i4", ],
            [ "m", "m1", "m2", "m3", "m4", ],
            [ "n", "n1", "n2", "n3", "n4", ],
            [ "o", "o1", "o2", "o3", "o4", ],
            [ "u", "u1", "u2", "u3", "u4", ],
            [ "ê", "ê1", "ê2", "ê3", "ê4", ],
            [ "ü", "ü1", "ü2", "ü3", "ü4", ],
        ],
    ];

    println!("// 符号音调");
    println!("// 第一声: 音调符号标记形式");
    codegen(1, styles[0]);
    println!("// 第二声: 音调符号标记形式");
    codegen(2, styles[0]);
    println!("// 第三声: 音调符号标记形式");
    codegen(3, styles[0]);
    println!("// 第四声: 音调符号标记形式");
    codegen(4, styles[0]);

    println!("// 数字音调");
    println!("// 第一声: 数字音调标记");
    codegen(1, styles[1]);
    println!("// 第二声: 数字音调标记");
    codegen(2, styles[1]);
    println!("// 第三声: 数字音调标记");
    codegen(3, styles[1]);
    println!("// 第四声: 数字音调标记");
    codegen(4, styles[1]);
}